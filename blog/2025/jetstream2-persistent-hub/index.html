<!doctype html><!-- This site was created with Hugo Blox. https://hugoblox.com --><!-- Last Published: April 29, 2025 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.7"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Work+Sans:wght@400;700" rel=stylesheet><script defer data-domain=2i2c.org src=https://plausible.io/js/script.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.1ef2b246940d070848099a3a4379e00d.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="Chris Holdgraf"><meta name=description content="When we first committed to offer Jetstream2 support at 2i2c, Jetstream2, Magnum, OpenStack, ClusterAPI were all new concepts that we hadn&rsquo;t used at 2i2c before. And although the initial exercise of reading about each of them independently was confusing, learning how they actually glued together was the key."><link rel=alternate hreflang=en-us href=https://2i2c.org/blog/2025/jetstream2-persistent-hub/><link rel=canonical href=https://2i2c.org/blog/2025/jetstream2-persistent-hub/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu8b94e13e0b17eede442ff7e6dd19ef02_1559_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu8b94e13e0b17eede442ff7e6dd19ef02_1559_180x180_fill_lanczos_center_3.png><meta name=theme-color content="rgb(29, 78, 245)"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@2i2c_org"><meta property="twitter:creator" content="@2i2c_org"><meta property="twitter:image" content="https://2i2c.org/media/opengraph-image-template_hu51a874180150a55e631114d14958827e_26672_filter_7292608746032874373.png"><meta property="og:type" content="website"><meta property="og:site_name" content="2i2c"><meta property="og:url" content="https://2i2c.org/blog/2025/jetstream2-persistent-hub/"><meta property="og:title" content="Offering Jetstream2-powered hub support at 2i2c | 2i2c"><meta property="og:description" content="When we first committed to offer Jetstream2 support at 2i2c, Jetstream2, Magnum, OpenStack, ClusterAPI were all new concepts that we hadn&rsquo;t used at 2i2c before. And although the initial exercise of reading about each of them independently was confusing, learning how they actually glued together was the key."><meta property="og:image" content="https://2i2c.org/media/opengraph-image-template_hu51a874180150a55e631114d14958827e_26672_filter_7292608746032874373.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2025-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-28T00:00:00+00:00"><title>Offering Jetstream2-powered hub support at 2i2c | 2i2c</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=d88ce7c65124e238cc3e3196ad4bdad0><script src=/js/wowchemy-init.min.1db830ffe01a1cc59425dcc73c1fdaa8.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/media/logo.svg alt=2i2c></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/media/logo.svg alt=2i2c></a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/platform/><span>Platform</span></a></li><li class=nav-item><a class=nav-link href=/communities/><span>Impact</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Service Principles</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/open-technology/><span>Commitment to Open Technology</span></a>
<a class=dropdown-item href=/right-to-replicate/><span>Right to Replicate</span></a></div></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>About</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/mission/><span>Mission and goals</span></a>
<a class=dropdown-item href=/organization/><span>Our organization and team</span></a>
<a class=dropdown-item href=/about/funding/><span>How we're funded</span></a>
<a class=dropdown-item href=/projects/><span>Projects we support</span></a>
<a class=dropdown-item href=/founders/><span>Origin story</span></a>
<a class=dropdown-item href=/jobs/><span>Jobs at 2i2c</span></a>
<a class=dropdown-item href=/collaborate/><span>Contact us to collaborate</span></a>
<a class=dropdown-item href=/brand/><span>Design and brand assets</span></a>
<a class=dropdown-item href=/donate/><span>Donate to 2i2c</span></a></div></li></ul><ul class="navbar-nav ml-md-auto"><li class=nav-item><a class=nav-link href=https://docs.2i2c.org/support target=_blank rel=noopener><span>support</span></a></li><li class=nav-item><a class=nav-link href=/blog><span>blog</span></a></li><li class=nav-item><a class=nav-link href=https://docs.2i2c.org target=_blank rel=noopener><span>docs</span></a></li><li class=nav-item><a class=nav-link href=/join><span>join us</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span>
</a><a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span>
</a><a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Offering Jetstream2-powered hub support at 2i2c</h1><div class=article-metadata><div><span><a href=/author/georgiana-dolocan/>Georgiana Dolocan</a></span></div><span class=article-date>Apr 28, 2025
</span><span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/service/>Service</a></span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:377px><div style=position:relative><img src=/media/opengraph-image-template_hu51a874180150a55e631114d14958827e_26672_c1a1ff60896fd3d35fabee339cf1b134.webp width=720 height=377 alt class=featured-image></div></div><div class=article-container><div class=article-style><p>When we first committed to offer
<a href=https://jetstream-cloud.org/index.html target=_blank rel=noopener>Jetstream2</a> support at 2i2c, Jetstream2,
<a href=https://docs.openstack.org/magnum/latest/ target=_blank rel=noopener>Magnum</a>,
<a href=https://www.openstack.org/ target=_blank rel=noopener>OpenStack</a>,
<a href=https://cluster-api.sigs.k8s.io/ target=_blank rel=noopener>ClusterAPI</a> were all new concepts that we hadn&rsquo;t used at 2i2c before.
And although the initial exercise of reading about each of them independently was confusing, learning how they actually glued together was the key.
This post is about Jetstream2, 2i2c persistent hub offerings, and the learning that took place in the process.</p><h2 id=context>Context
<a class=header-anchor href=#context>#</a></h2><p>At 2i2c, we want to be able to deploy k8s clusters on different cloud providers. In a very simplistic way, for this we use:</p><ul><li><code>Infrastructure as code</code> to describe, deploy and manage the actual physical infrastructure from the cloud providers</li><li>Cloud specific CLI to authenticate to this infrastructure</li><li><a href=https://helm.sh/ target=_blank rel=noopener><code>Helm</code></a> to deploy and manage k8s resources onto this infrastructure</li><li>And finally
<a href=https://kubernetes.io/docs/reference/kubectl/ target=_blank rel=noopener><code>kubectl</code></a> to interact with all of these k8s resources</li></ul><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=./2i2c-generic-infra.png alt=image loading=lazy data-zoomable></div></div></figure>(Main tools used at 2i2c to deploy and manage k8s clusters on different cloud providers)</p><p>On cloud providers like GCP, AWS, Azure, the Kubernetes support feels like an atomic feature of the cloud provider and works out of the box. But on Jetstream2, k8s support is not such a solid feature anymore.</p><h2 id=jetstream2-kubernetes-support-stack>Jetstream2 Kubernetes support stack
<a class=header-anchor href=#jetstream2-kubernetes-support-stack>#</a></h2><p>Jetstream2 is a collection of supercomputers that are part of the
<a href=https://access-ci.org/ target=_blank rel=noopener>ACCESS cyberinfrastructure</a>. This ACCESS infrastructure groups together super computers like Jetstream2 (but not limited to it), into a mesh that creates the impression of a single, virtual system that scientists can openly access and interactively use.</p><p>It offers Infrastructure as a Service (IaaS), that allows users to deploy VMs and manage environments dynamically. And the piece that enables this Infrastructure as a Service feature is OpenStack.</p><h3 id=openstack-and-magnum>OpenStack and Magnum
<a class=header-anchor href=#openstack-and-magnum>#</a></h3><p>OpenStack is an open source platform made of multiple projects that help build and manage both private and public cloud infrastructure.</p><p>For our use-case, one of the most relevant OpenStack sub-project is Magnum. Magnum offers container orchestration engines for deploying and managing containers, like Kubernetes, but not limited to it.</p><p>Initially, Kubernetes support was provided through a project called
<a href=https://wiki.openstack.org/wiki/Heat target=_blank rel=noopener>HEAT</a>. However that has proven harder to manage and maintain, and it was extremely hard to upgrade a cluster. So, they’ve migrated towards a new driver called
<a href=https://docs.openstack.org/magnum-capi-helm/latest/user_docs/index.html target=_blank rel=noopener>Cluster API magnum driver</a>, which offers a more native k8s integration.</p><h3 id=cluster-api-and-capi-helm-driver>Cluster API and CAPI helm driver
<a class=header-anchor href=#cluster-api-and-capi-helm-driver>#</a></h3><p>CAPI itself is k8s project that allows declaring k8s clusters in an easy way.</p><p>The helm driver on the other hand is what acts like a bridge between OpenStack’s Magnum and Kubernetes’ Cluster API (CAPI). Its main goal is to to manage the lifecycle (create, scale, upgrade, destroy) of Kubernetes-conformant clusters using a declarative API.</p><p>In order to do this, Cluster API provides an API for being able to manage the various components of a Kubernetes cluster. This conceptually looks like a Kubernetes cluster managing other Kubernetes clusters; the former, named the ‘CAPI management cluster’, is the one providing the API for managing the latter workload clusters.</p><h3 id=decomposing-the-previous-atomic-feature>Decomposing the previous atomic feature
<a class=header-anchor href=#decomposing-the-previous-atomic-feature>#</a></h3><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=./Jetstream2-and-tent.png alt=image loading=lazy data-zoomable></div></div></figure>(Comparison between Jetstream2 and other cloud providers when it comes to k8s support)</p><p>Magnum is part of the OpenStack tent and it’s the first layer on top of Jetstream2 towards achieving k8s support.</p><p>The CAPI helm driver is what’s offering CAPI support. This is the last piece that’s needed to link a k8s cluster down to the hardware where it’s deployed, on Jetstream2.</p><h2 id=challenges>Challenges
<a class=header-anchor href=#challenges>#</a></h2><p>The Jetstream2-OpenStack stack is not a simple one. It’s a complex stack of technologies and each of the connection points can be challenging to debug and fix when something doesn&rsquo;t work. Especially when you are one of the first ones that pilots this new magnum driver setup.</p><p>So, it was expected that we faced some issues along the way. However, we were able to go around them and add Jetstream2 to our service menu. Below is a list of some of the issues that we faced:</p><ol><li>We have to create terraform resource in sequence which takes longer because of a race condition that makes concurrent nodegroups creation requests to fail</li></ol><ul><li><a href=https://bugs.launchpad.net/magnum/+bug/2097946 target=_blank rel=noopener>bugs.launchpad.net/magnum/+bug/2097946</a></li></ul><ol start=2><li>The role and labels of the nodegroups don&rsquo;t get propagated to the actual nodes, so we cannot put our own labels on nodes at once</li></ol><ul><li><a href=https://github.com/azimuth-cloud/capi-helm-charts/issues/84 target=_blank rel=noopener><i class='fa-brands fa-github'></i> azimuth-cloud/capi-helm-charts#84</a></li></ul><ol start=3><li>The node count and min node count cannot be set to 0 and each nodegroup has to have at least 1 node</li></ol><ul><li><a href=https://bugs.launchpad.net/magnum/+bug/2098002 target=_blank rel=noopener>bugs.launchpad.net/magnum/+bug/2098002</a></li></ul><ol start=4><li>A default-worker is created apart from the default-control plane nodegroup and we cannot delete it due to the same issue as in 2.</li><li>Latest CAPI helm chart version causes autoscaling to stop working in a persistent hub setup, so we had to downgrade it to a previous version</li></ol><ul><li><a href=https://github.com/2i2c-org/infrastructure/issues/5601 target=_blank rel=noopener><i class='fa-brands fa-github'></i> 2i2c-org/infrastructure#5601</a></li></ul><h2 id=conclusion>Conclusion
<a class=header-anchor href=#conclusion>#</a></h2><p>The biggest plus, is the people. We got support from
<a href=https://github.com/julianpistorius target=_blank rel=noopener>Julian Pistorius</a>, which has helped us a lot to both fix and validate some of the behaviours we were experiencing. Also, going through the
<a href=https://jetstream-cloud.org/contact/index.html target=_blank rel=noopener>Jetstream2 support process</a> was also a pleasant experience because they were super prompt in answering and they were very nice.</p><p>Jetstream2 has a big plus over the other cloud providers with its openness thought the ACCESS program. This is something very handy to researchers and less costly than other cloud providers. 2i2c being able to offer hubs though this ACCESS program makes things more accessible to more researchers and more cost efficient.</p><p>Higher complexity comes also with more control over the infrastructure which has its advantages.</p><p>Leaving the challenges apart, the experience was a nice one and the outcome was positive -> 2i2c is now able to deploy both mybinder.org-like hubs as well as persistent storage hubs on Jetstream2 hardware, from the same cloud-agnostic infrastructure.</p></div><div class=article-tags><a class="badge badge-light" href=/tag/open-source/>Open-Source</a></div><div class=share-box><ul class=share></ul></div><div class="media author-card content-widget-hr"><a href=/author/georgiana-dolocan/><img class="avatar mr-3 avatar-circle" src=/author/georgiana-dolocan/avatar_hu5a78bf28ffb183ff0de0c23a9805fa26_292451_270x270_fill_q75_lanczos_center.jpg alt="Georgiana Dolocan"></a><div class=media-body><h5 class=card-title><a href=/author/georgiana-dolocan/>Georgiana Dolocan</a></h5><h6 class=card-subtitle>Open Source Infrastructure Engineer</h6><ul class=network-icon aria-hidden=true><li><a href=mailto:georgianaelena@2i2c.org><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/GeorgianaElenaD target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href=https://github.com/georgianaelena target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><div class="row justify-content-center mb-4"><div class="col-6 col-md-4"><h5>About</h5><ul class="nav flex-column"><li class="nav-item mb-2"><a href=/mission class="nav-link p-0 text-muted">Mission and goals</a></li><li class="nav-item mb-2"><a href=/organization class="nav-link p-0 text-muted">Team and organization</a></li><li class="nav-item mb-2"><a href=https://compass.2i2c.org class="nav-link p-0 text-muted">Organizational documentation</a></li><li class="nav-item mb-2"><a href=/jobs class="nav-link p-0 text-muted">Jobs at 2i2c</a></li><li class="nav-item mb-2"><a href=/blog class="nav-link p-0 text-muted">Blog</a></li></ul></div><div class="col-6 col-md-4"><h5>Technical</h5><ul class="nav flex-column"><li class="nav-item mb-2"><a href=https://github.com/2i2c-org class="nav-link p-0 text-muted">GitHub</a></li><li class="nav-item mb-2"><a href=https://docs.2i2c.org/ class="nav-link p-0 text-muted">Documentation</a></li><li class="nav-item mb-2"><a href=https://docs.2i2c.org/about/service/options/ class="nav-link p-0 text-muted">Pricing</a></li></ul></div><div class=col-md-4><form><h5>Subscribe to our newsletter</h5><div><a href="https://2i2c.us2.list-manage.com/subscribe?u=494ab59616acdfc381a699b44&id=94ce07e556">Join our mailing list</a></div></form><h5>Follow us online</h5><style>.footer__brand-icons{font-size:1.3em;display:flex;gap:.5rem}</style><div class=footer__brand-icons><a href=https://github.com/2i2c-org/2i2c-org.github.io><i class="fa-brands fa-github"></i>
</a><a href=https://twitter.com/2i2c_org><i class="fa-brands fa-twitter"></i>
</a><a href=http://eepurl.com/hjHbff><i class="fa-solid fa-envelope"></i></a></div></div></div><div class="license mb-3">© 2024 2i2c. This work is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/>CC-BY 4.0 license</a>.</div><p class=powered-by>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a> — the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.ff7771056d34ad9f2de2d8f6a466e748.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script><script src=/en/js/wowchemy.min.7f5ebaff62ae468cff8bb3dd1337bb9b.js></script><script src=/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script></body></html>